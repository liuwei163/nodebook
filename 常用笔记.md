# 一、操作系统命令



- 设置服务开机自启动并立即启动：
  - systemctl  enable  --now  mariadb
- 查找容器服务从那里启动：
  - docker inspect 容器 | grep –i source
- 查看linux系统所有的内置命令:
  - compgen -b
- 查看当前系统登录的用户命令：
  - whoami 

## 1.1 centos7系统命令使用

### 1.1.1 最小化安装需要下载的工具

```sh
# centos
yum -y install lrzsz vim wget net-tools bash-completion epel-release bc  psmisc
# ubuntu (官方源包含了centos的epel-release的额外软件包)
apt -y install lrzsz vim wget net-tools bash-completion  bc  psmisc
```

### 1.1.2 nmcli命令的使用(参数可以简写为参数的首字母)

```sh
(1)显示所有网络接口设备的状态
nmcli   device   status
(2)查看网卡的uuid
nmcli  connection
(3)删除网卡的uuid
在网卡的配置文件直接删除，然后自动生成新的uuid
# 删除网卡的uuid：在网卡的配置文件中直接删除就会生成新的uuid
```

### 1.1.3 ps命令的使用

```sh
(1)查看所有进程
ps ax  或者   ps -e     ps aux      ps -ef
## 注：当用户名超过8个字符时，以uid显示；小于等于8字符时，以用户名显示。
## 加上-f或者u参数可以显示进程的详细信息

(2)通过进程名或者进程id显示进程
ps  -ef  |  grep   进程名或进程id

(3)显示当前yong'h的进程（zero）默认是root用户
ps -f -u zero

(4)利用cpu和内存使用量对进程排序
ps aux --sort=-pcpu,+pmem   | head 5

(5)显示进程的线程
[root@ansible-node2 ~]# ps -ef | grep httpd
 本身进程的id   父进程的id
root         10109          1      0 11月20 ?      00:00:06 /usr/sbin/httpd -DFOREGROUND
apache    10110      10109  0 11月20 ?      00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    10112      10109  0 11月20 ?      00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    10113      10109  0 11月20 ?      00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    10114      10109  0 11月20 ?      00:00:00 /usr/sbin/httpd -DFOREGROUND
apache    10115      10109  0 11月20 ?      00:00:00 /usr/sbin/httpd -DFOREGROUND
root      14084       7525  0 15:23 pts/0    00:00:00 grep --color=auto httpd
[root@ansible-node2 ~]# ps -p 10109 -L
   PID    LWP TTY          TIME CMD
 10109  10109 ?        00:00:06 httpd

(6)显示父进程的子进程
root@zero:~#  ps -o pid,uname,comm -C nginx
    PID USER     COMMAND
    732 root     nginx
    736 www-data nginx
    737 www-data nginx
root@zero:~# ps --ppid 732
    PID TTY          TIME CMD
    736 ?        00:00:00 nginx
    737 ?        00:00:00 nginx

(7)显示进程已运行的时间
ps -e -o pid,comm,etime  | grep nginx

(8)用ps命令实时显示进程信息
watch -n 1 'ps -e -o pid,uname,cmd,pmem,pcpu --sort=-pmem,-pcpu | head -15'

(9)pstree命令的使用
1）查看进程树
pstree
2）查看进程的id
pstree   -p | grep  nginx
3）安装pstree命令
yum -y install psmisc
```

### 1.1.4 查看内存的详细信息

```sh
(1) free
各个数值解释：
total          used         free            shared                buff/cache         available
总内存          已使用        可用         多个进程共享的内存大小        磁盘缓存大小      可被新程序使用大小

(2)禁用swap（交换内存）
[root@master ~]# swapoff –a       （临时关闭）
[root@node01 ~]# vim /etc/fstab
# /dev/mapper/cl-swap swap swap defaults 0 0     （在开头加#号注释掉###永久关闭）
[root@master ~]# free -h   （验证是否关闭）
```

### 1.1.5 修改linux系统中的时区和时间

```sh
# 查看当前时间
date
# 删除当前时间
rm -rf /etc/localtime #删除当前默认时区
# 将当前时区修改为上海时区命令：
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime #修改默认时区为上海
# 修改时间：
date -s "20140225 20:16:00"  # yyyymmdd hh:mm:ss

# 查看硬件的时间：
hwclock --show
# 设置硬件时间：
hwclock --set --date="10/28/2020 10:15:15“
# 设置系统时间和硬件时间同步：
hwclock --hctosys
# 保存时间（一定要保存设置，否则下次重新启动时，设置会失效）：
hwclock -w
```

### 1.1.6 开启路由转发

```sh
# 用来启用linux内核的IP转发功能，允许包在不同网络接口之间传输。
echo net.ipv4.ip_forward = 1 >> /etc/sysctl.conf

sysctl -p
```

### 1.1.7 创建连续多个文件夹和文件

```sh
# 文件夹/目录
mkdir file{1..5}
# 文件
touch file{1..5}
```

### 1.1.8 linux中设置tab键的空格个数

```sh
(1)centos系统下
[root@master ~]# vim .vimrc
set tabstop=2
[root@master ~]# source .vimrc

(2)ubuntu系统下
1.vim /etc/vim/vimrc
2.#按大写G到最后一行添加    set ts=4
3.# 保存退出
```

### 1.1.9 复制文件到另一台主机

```sh
scp   文件路径/文件    连接使用的用户@目标主机IP:/目标主机存放路径
scp  /tmp/test.txt   root@192.168.1.10:/tmp/
```

### 1.1.10 centos系统防火墙的操作

```sh
(1)关闭selinux
setenfore 0   (临时关闭)
sed  -i 's/^\(SELINUX=\).*/\1disabled/g'  /etc/selinux/config   （永久关闭）

(2)关闭防火墙
systemctl  stop  firewalld           
systemctl  disable   firewalld    ##禁止开机自启动

# firewalld防火墙关于端口指令
firewall-cmd --list-port　##查看开放的端口
firewall-cmd --zone=public --add-port=80/tcp –permanent ##开启端口指令
firewall-cmd –reload     ###重启防火墙
systemctl status firewalld  ###查看firewall服务状态
service firewalld start    ###开启防火墙
service firewalld restart   ##重启防火墙
service firewalld stop    ##开启防火墙
systemctl disable firewalld  ###禁止firewall开机启动
systemctl enable firewalld  ###设置firewall开机启动
```

### 1.1.11 添加nameserver域名解析

```sh
在/etc/resolv.conf文件中添加需要解析的域名及IP
[root@ansible-node2 ~]# cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 8.8.8.8


```

### 1.1.12 查看系统的版本信息

```sh
uname  -r  
uname  -a
cat  /etc/redhat/rel
```

### 1.1.13 修改主机名称（重启或执行bash生效）

```sh
hostnamectl set-hostname newname （永久）
hostname  newname  （临时）
```

### 1.1.14 配置密钥对

```sh
ssh-keygen -t  rsa    # 执行此命令一路回车即可
cd ~/.ssh
# 发送公钥到其他节点
ssh-copy-id  node2     
ssh-copy-id  node3
```

### 1.1.15 <<EOF >         EOF 的使用方法 

```sh
# 格式EOF未加引号时，当追加的内容里面有$符号，shell执行时发现有$符号，就会按照变量执行。所以如果追加的内容里面有$符号，应该添加转义字符（\）转义。例如

cat >> /etc/profile << EOF       #说明：这里的EOF没有加单引号，则shell默认会解析特殊字符，如遇$符号解析变量值
#KAFKA ENVIRONMENT
export KFK_HOME=/usr/local/kafka
export PATH=$KFK_HOME/bin:$PATH         #这里将被解析成环境变量PATH的值
EOF

# 有$符号时，未添加转义字符时，想内容就是字符串，不让shell自动解析怎么办？则在第1个EOF用单引号把括起来，如下：

cat >> /etc/profile << 'EOF'     
#KAFKA ENVIRONMENT
export KFK_HOME=/usr/local/kafka
export PATH=$KFK_HOME/bin:$PATH    
EOF                                #最后这个EOF不需要加单引号，否则shell将识别不了结束符
```



```sh

# 写入文件并覆盖内容
cat <<EOF > 文件的路径 
文件内容 
文件内容 
EOF

# 将内容追加到文件的末尾
cat >> 文件路径 << EOF 
文件内容
文件内容
EOF
```

### 1.1.16  清空防火墙规则

```sh
sudo iptables -F && sudo iptables -X && sudo iptables -F -t nat && sudo iptables -X -t nat
sudo iptables -P FORWARD ACCEPT
```

### 1.1.17 vim 命令的使用

```sh
# 合并多个文件内容
1. Vim打开文件进入命令行输入r 文件名即可  
vim  file1.txt
: r file2.txt
2. cat 命令同时合并多个文件 按照顺序来合并,使用>符号形成新的文件。  
Cat file1 file2 file3 >  file
```

```sh
# vim加密文件
根据提示设置密码，再次打开文件即需要密码才能正常查看
1）vim -x   file1.txt
解密：在末行模式中输入如下内容，保持退出即可
2）:set  key=
```

```sh
# 查看文件是否是windows文件
如果有CRLF字符就说明是windows文件，只有ASCII就是linux文件。
file windows.txt
windows.txt: ASCII text, with CRLF line terminators

# 使用vim命令更改文件格式
进入文件
vim windows.txt
改为linux文件，在末行模式输入
:set ff=unix
改为windows文件，在末行模式输入
:set ff=dos

使用vim将文件加密根据提示设置密码，再次打开文件即需要密码才能正常查看
1）vim -x  file1.txt
解密：在末行模式中输入如下内容，保存退出即可
2）:set key=
```



### 1.1.18 解压和打包文件及文件夹

```sh
# 打包
tar -czvf .gz格式的 gzip打包压缩包
tar -cjvf .bz2格式的bzip2打包压缩包
tar -cJvf .xz格式的xz打包压缩包
# 解压
tar -xzf 解压gzip格式的压缩包
tar -xjf 解压bzip2格式的压缩包
tar -xJf 解压xz 格式的压缩包

# 分卷压缩
split -d -b 30000m apk.tar  apk_2015.tar-
# 解压
cat apk_2015.tar-* | tar -jx
# 合并分开的包
cat apk_2015.tar-* > apk.tar

# 打包过滤
tar --exclude “要过滤内容” -czvf 123.tar.gz 源文件

#################################
# war包解压到指定目录，使用-d选项
unzip /opt/sdsc.war -d /opt/EETRUST/BSD/bsdserver/webapps/sdsc
unzip /opt/securedoc.war -d /opt/EETRUST/BSD/bsdserver/webapps/securedoc
```

### 1.1.19 查看对应网口是否启用

```sh
1，ethtool -p eth0 # 此时eth0网口就会闪烁
2，mii-tool eth0   # 回应的是 link ok 即对应网口已经连接网线。反之则不是。
```

### 1.1.20 禁用root远程操作

```sh
$ vi /etc/ssh/sshd_config
# 把
PermitRootLogin yes
# 改为
PermitRootLogin no
# 重启ssh
$ service sshd restart
```

### 1.1.21 挂载光盘用系统盘作为yum源实现离线安装

```sh
cd /etc/yum.repos.d/
mkdir local
mv *.repo local
yum clean all
yum makecache

cd /etc/yum.repos.d/
vi local.repo
# 加上这些
[local]
name=local
baseurl=[file:///media](file:///media)
enabled=1
gpgcheck=0

# 挂载系统盘：
mount /dev/sr0 /media
# 然后执行指令：
yum list | grep kernel-devel
yum -y install kernel-devel      
```

### 1.1.21 lsblk命令的日常使用

```sh
(1)显示所有的块设备信息
lsblk
(2)显示指定的设备的信息
lsblk  /dev/sda
(3)显示设备树形结构
lsblk  -t
(4)显示挂载点信息
lsblk  -m
(5)显示设备的名称、大小和类型
lsblk  -o  NAME,SIZE,TYPE
```

### 1.1.22 更改mac地址

```sh
# 长期更改即为绑定，真实mac是写在网卡芯片里的，无法更改。 

临时更改:
ifconfig eth0 down

ifconfig eth0 hw ether mac地址

ifconfig eth0 up

长期更改:
/etc/sysconfig/network-scripts/ifcfg-eth0中加入下面一句话：

MACADDR=mac地址
```

### 1.1.23 查看文件中出去空白行和注释行的内容

```sh
cat filename | grep ^[^#]
```

### 1.1.24 将进程放到后台去执行

```sh
screen ./执行的文件
ctrl + a + d # 按a 松开再按d  
```

### 1.1.25 wc -l 和wc -L的区别

```sh
1、统一test1.txt文件有多少行
cat test1.txt | wc -l 
2、统计test1.txt文件中最长一行的字符数
cat test1.txt | wc -L
```

### 1.1.26  查看硬盘的固件版本

```sh
lsscsi -sg
```

### 1.1.27  查看进程树pstree  

```sh
pstree 查看
pstree  -p | grep nginx # 查看nginx进程及进程号
yum -y install psmisc ##安装pstree命令
```

### 1.1.28 查看文件的md5值

```sh
# linux查看文件的md5值
md5sum  文件名

# windows查看文件的MD5\SHA1\SHA256的值
certutil  -hashfile yourfilename.txt  MD5
certutil  -hashfile yourfilename.txt  SHA1
certutil  -hashfile yourfilename.txt  SHA256
```

### 1.1.29

```sh

```

### 1.1.30 检查内存详细信息。显示内存槽位/大小/SN

```sh
dmidecode -t memory |grep -E "Locator:|Size:|Serial Number: "|grep -v Bank |grep -v DIMM |grep -v Module
```

### 1.1.31 查看cpu信息

```sh
# lscpu

查看逻辑CPU个数：
#cat /proc/cpuinfo |grep "processor"|sort -u|wc -l
24
 
查看物理CPU个数：
#grep "physical id" /proc/cpuinfo|sort -u|wc -l                   
2
#grep "physical id" /proc/cpuinfo|sort -u                   
physical id     : 0
physical id     : 1
 
查看每个物理CPU内核个数：
#grep "cpu cores" /proc/cpuinfo|uniq
cpu cores       : 6
 
每个物理CPU上逻辑CPU个数：
#grep "siblings" /proc/cpuinfo|uniq
siblings        : 12
 
判断是否开启了超线程：
如果多个逻辑CPU的"physical id"和"core id"均相同，说明开启了超线程
或者换句话说
 逻辑CPU个数 > 物理CPU个数 * CPU内核数   开启了超线程
 逻辑CPU个数 = 物理CPU个数 * CPU内核数   没有开启超线程
```

> 使用脚本一次性查看

```sh
#!/bin/bash
 
physicalNumber=0
coreNumber=0
logicalNumber=0
HTNumber=0
 
logicalNumber=$(grep "processor" /proc/cpuinfo|sort -u|wc -l)
physicalNumber=$(grep "physical id" /proc/cpuinfo|sort -u|wc -l)
coreNumber=$(grep "cpu cores" /proc/cpuinfo|uniq|awk -F':' '{print $2}'|xargs)
HTNumber=$((logicalNumber / (physicalNumber * coreNumber)))
 
echo "****** CPU Information ******"
echo "Logical CPU Number  : ${logicalNumber}"
echo "Physical CPU Number : ${physicalNumber}"
echo "CPU Core Number     : ${coreNumber}"
echo "HT Number           : ${HTNumber}"
 
echo "*****************************"
```

### 1.1.32 持续监控命令执行结果

```sh
watch  kubectl  get pod -o wide
#每隔一秒刷新一次
watch  -n  1  kubectl  get  pod -o  wide
```

### 1.1.33 

```sh
root@zero:~# uname -r
5.15.0-117-generic

root@zero:~# uname -a
Linux zero 5.15.0-117-generic #127-Ubuntu SMP Fri Jul 5 20:13:28 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux

root@zero:~# lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:        22.04
Codename:       jammy
```

### 1.1.34 ubuntu修改为阿里云下载源（apt）

```sh
############### centos7 ##############
## 备份系统自带yum源
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
## 下载阿里云yum源并配置为yum基础源
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
# 没有wget情况下可使用curl  查看源内容手动复制到基础源文件中
curl https://mirrors.aliyun.com/repo/Centos-7.repo

## 依据阿里云源更新软件包
yum -y update


#################### ubuntu22.04版本更新源为阿里云###################

在Ubuntu 22.04中使用国内源可以提高软件包下载和更新的速度。以下是如何设置国内源的步骤：
备份原有的sources.list文件：
sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup
编辑sources.list文件：
sudo nano /etc/apt/sources.list
替换文件内容为国内源。以阿里云源为例，你可以将文件内容替换为以下内容：
deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
 
deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse

保存并关闭文件。
更新软件源：
sudo apt update

升级所有安装的包：
sudo apt upgrade


################# 查询 LTS 版本： ########################## 

## 不按照lts版本会出现无法下载、无法解析域名等报错

root@user-virtual-machine:~# lsb_release  -a 
No LSB modules are available.
Distributor ID:    Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:    22.04
Codename:    jammy
root@user-virtual-machine:~# 
#####
Ubuntu 22.04代号为：jammy
Ubuntu 20.04代号为：focal
Ubuntu 19.04代号为：disco
Ubuntu 18.04代号为：bionic
Ubuntu 17.04代号为：zesty
Ubuntu 16.04代号为：xenial


```

### 1.1.35 lsof命令的使用

```sh
# 1.安装lsof
yum -y install lsof
# 2.lsof不带任何参数，列出当前所有活跃进程打开的所有文件（添加more进行分页输出）
[root@docker ~]# lsof | more
COMMAND      PID   TID    USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME
systemd        1          root  cwd       DIR              253,0       245         64 /
systemd        1          root  rtd       DIR              253,0       245         64 /
systemd        1          root  txt       REG              253,0   1616360   33859263 /usr/lib/systemd/systemd
# 输出结果中，第一列中 systemd 的进程ID是 1,它是一个守护进程
# 其中列 COMMAND 、PID、USER 分别表示进程名、进程ID、所属用户
# FD是文件描述符：
	可能的类型：cwd	当前目录
			  txt	txt文件
              rtd	root目录
              mem	内存映射文件
              
# TYPE 是文件类型，下面是可能的值以及说明：
DIR	      目录
REG	      普通文件
CHR	      字符
a_inode	  Inode文件
FIFO	  管道或者socket文件
netlink	  网络
unknown	  未知

# 列 DEVICE 表示设备ID
# 列 SIZE/OFF 表示进程大小
# 列 NODE 表示文件的Inode号
# 列 NAME 表示路径或者链接
```

```sh
# 1.列出指定用户打开的文件
lsof -u  root | more
# 2.排除指定用户已经打开的文件
lsof -u ^root | more
# 3.列出所有打开了的网络文件 【加参数4或者6可以列出对应ipv4或ipv6的网络文件】
## （列出已经打开了ipv4的网络文件：lsof -i 4）
## （列出已经打开了ipv6的网络文件：lsof -i 6）
[root@docker ~]# lsof -i
COMMAND     PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
sshd       2626   root    3u  IPv4 351588      0t0  TCP docker:ssh->10.2.17.149:57084 (ESTABLISHED)
sshd       2628   root    3u  IPv4 351679      0t0  TCP docker:ssh->10.2.17.149:57085 (ESTABLISHED)
chronyd    6087 chrony    1u  IPv4  41016      0t0  UDP localhost:323
chronyd    6087 chrony    2u  IPv6  41017      0t0  UDP localhost:323
dhclient   6223   root    6u  IPv4  42735      0t0  UDP *:bootpc
sshd       6805   root    3u  IPv4  46124      0t0  TCP *:ssh (LISTEN)
sshd       6805   root    4u  IPv6  46133      0t0  TCP *:ssh (LISTEN)
master     7268   root   13u  IPv4  47844      0t0  TCP localhost:smtp (LISTEN)
master     7268   root   14u  IPv6  47845      0t0  TCP localhost:smtp (LISTEN)
docker-pr 92764   root    4u  IPv6 177832      0t0  TCP *:websm (LISTEN)

# 4.使用 lsof -i:端口号 可以获得所有在指定端口号上打开的文件
[root@docker ~]# lsof -i:22
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
sshd    2626 root    3u  IPv4 351588      0t0  TCP docker:ssh->10.2.17.149:57084 (ESTABLISHED)
sshd    2628 root    3u  IPv4 351679      0t0  TCP docker:ssh->10.2.17.149:57085 (ESTABLISHED)
sshd    6805 root    3u  IPv4  46124      0t0  TCP *:ssh (LISTEN)
sshd    6805 root    4u  IPv6  46133      0t0  TCP *:ssh (LISTEN)

# 5.lsof -i TCP/UDP 列出使用了TCP 或 UDP 协议的文件
lsof -i TCP | more
lsof -i UDP | more
使用 lsof -i TCP:1-1024 列出使用了TCP协议并且端口范围为 1 到 1024 的文件

# 6.列出 data 目录中打开的文件(进入目录、查看中文件，修改中的文件)
## +D 选项会列出一个目录和其子目录中打开的文件，而 +d 选项只会列出当前目录下已打开的文件
[root@ecs-centos-7 tt]# lsof +D ./data/
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
bash    28473 root  cwd    DIR  253,1     4096 131146 ./data
bash    28502 root  cwd    DIR  253,1     4096 131172 ./data/dira
vim     28530 root  cwd    DIR  253,1     4096 131172 ./data/dira
vim     28530 root    4u   REG  253,1    12288 131174 ./data/dira/.a.txt.swp

# 7.列出指定进程ID打开的文件（可同时指定多个进程ID，使用逗号分隔）
lsof -p 1054
lsof -p 8080，8089，8090

#### 杀死指定用户的所有进程
kill -9 `lsof -t -u tt`
# 上述命令中，lsof -u tt 是列出tt用户所有打开的文件，加上 -t 选项之后表示结果只列出PID列，也就是进程ID列，其他列都忽略，前面的 kill -9 表示强制结束指定的进程ID
```

### 1.1.36 tree命令的使用

```sh
# 1.查看目录结构（列出所有目录及文件）
tree /opt
# 2.只列出目录
tree -d /opt
# 3.列出目录和更改时间
tree -D /opt
# 4.如果你想把一个目录的结构树导出到文件 Readme.md ,可以这样操作
tree -L 2 >README.md //然后我们看下当前目录下的 README.md 文件

```

```sh
-a 显示所有文件和目录。

-A 使用ASNI绘图字符显示树状图而非以ASCII字符组合。

-C 在文件和目录清单加上色彩，便于区分各种类型。

-d 显示目录名称而非内容。

-D 列出文件或目录的更改时间。

-f 在每个文件或目录之前，显示完整的相对路径名称。

-F 在执行文件，目录，Socket，符号连接，管道名称名称，各自加上"*","/","=","@","|"号。

-g 列出文件或目录的所属群组名称，没有对应的名称时，则显示群组识别码。

-i 不以阶梯状列出文件或目录名称。

-L level 限制目录显示层级。

-l 如遇到性质为符号连接的目录，直接列出该连接所指向的原始目录。

-n 不在文件和目录清单加上色彩。

-N 直接列出文件和目录名称，包括控制字符。

-p 列出权限标示。

-P<范本样式> 只显示符合范本样式的文件或目录名称。

-q 用"?"号取代控制字符，列出文件和目录名称。

-s 列出文件或目录大小。

-t 用文件和目录的更改时间排序。

-u 列出文件或目录的拥有者名称，没有对应的名称时，则显示用户识别码。

-x 将范围局限在现行的文件系统中，若指定目录下的某些子目录，其存放于另一个文件系统上，则将该子目录予以排除在寻找范围外。

```

## 1.2 ubuntu系统

### 1.2.1 ubuntu 查看网卡驱动版本

```sh
lspci -v 查看网卡
```

### 1.2.2 ububtu系统查看当前系统版本和架构

```sh
# 查看系统版本
root@zero:~# uname -r
5.15.0-117-generic

root@zero:~# uname -a
Linux zero 5.15.0-117-generic #127-Ubuntu SMP Fri Jul 5 20:13:28 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux

root@zero:~# lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:        22.04
Codename:       jammy
# 查看系统架构
root@zero:~# uname -m

输出结果为 x86_64：表示系统是 64 位的 x86 架构，这是常见的英特尔或 AMD 处理器的架构。
输出结果为 i386、i486、i586 或 i686：表示系统是 32 位的 x86 架构。
输出结果为 aarch64：表示系统是 ARM64 架构，通常用于基于 ARM 处理器的设备。
## 方法二：查看 /proc/cpuinfo 文件
root@zero:~# cat /proc/cpuinfo

然后在输出信息中查找相关的架构描述：
如果看到类似 model name : Intel... 或者 model name : AMD... 等内容，通常表示是 x86 架构。
如果看到 CPU architecture: 8 或者 CPU implementer : 0xXX（XX 是特定的 ARM 厂商代码）等内容，则表明是 ARM 架构，并且结合 uname -m 输出的 aarch64 可以确定是 ARM64 架构。
```

### 1.2.3 ubuntu系统允许图形化界面使用root登录

正常情况只需要操作第四步即可 使用图形化root登录

```sh
# 1.查看当前使用的显示管理器
sudo systemctl list-units --type=service | grep -E 'display-manager|gdm|lightdm|sddm'

若结果显示 gdm 或 gdm3：说明你使用的是 GNOME 显示管理器（GDM），这种情况下可以尝试对 GDM 进行配置来允许 root 用户图形化登录。
若结果显示 lightdm：虽然没有找到 lightdm.conf 文件，但仍可尝试手动创建并配置。

# 2.修改GDM自定义配置文件，确保文件中包含以下内容。
sudo  vim /etc/gdm3/custom.conf

[daemon]
## 若遇到图形显示问题，可尝试强制使用 Xorg
WaylandEnable=false
## 允许手动输入用户名登录
AllowManualLogin=true
## 允许用户选择 `root` 用户登录
AutomaticLoginEnable=false

# 3. 修改完成后重启GDM服务
sudo  systemctl restart gdm3

# 4. 检测PAM配置
sudo vim /etc/pam.d/gdm-password

确保文件中没有限制 root 用户登录的规则，避免类似 auth required pam_succeed_if.so user != root quiet_success 这样的规则存在，若有则注释掉（在行首加 #）。保存并退出后尝试重新登录。
```

### 1.2.4 ubuntu安装docker

```sh
# 1.更新系统软件包
sudo apt update
sudo apt upgrade -y
# 2.安装依赖
sudo apt install apt-transport-https ca-certificates curl software-properties-common -y
# 3.添加docker官方的GPG密钥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
# 4.添加docker软件源
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
# 5.再次更新软件包列表
sudo apt update
# 6.安装docker引擎、Docker CLI 和 containerd 等相关组件。
sudo apt install docker-ce docker-ce-cli containerd.io -y
```



# 二、docker的常用命令

## 2.1

### 2.1.1 把容器制作成镜像

```sh
docker commit 容器名称 镜像名:TAG
```

### 2.1.2 根据dockerfile文件制作镜像

```sh
 (镜像名称和标签) 
 			#-t 指定生成的镜像名称，-f 指定使用的yaml文件
 docker build -t centos7-nginx  -f dockerfile_name .
```

### 2.1.3 容器和主机互相拷贝文件

```sh
# 从容器里面拷文件到宿主机
docker cp testtomcat：/usr/local/tomcat/webapps/test/js/test.js /opt
# 从宿主机拷文件到容器里面
docker cp /opt/test.js testtomcat：/usr/local/tomcat/webapps/test/js

# 需要注意的是，不管容器有没有启动，拷贝命令都会生效。
```

### 2.1.4  退出docker swarm集群的命令

```sh
1.管理器节点离开Docker Swarm模式
docker swarm leave --force
2.普通节点离开Docker Swarm模式
docker swarm leave
3.重新开启Docker Swarm模式
docker swarm init38
```



# 三、 mysql数据库

## 3.1 

### 3.1.1 导入导出数据库

```sh
导出数据库：# mysqldump –u用户名 –p数据库 〉 数据库名.sql
导入数据库：# mysql –u用户名 –p数据库
```

### 3.1.2 修改mysql数据库的root密码

```sh
alter user  root@localhost  identified by 'llyy@123!';FLUSH PRIVILEGES;
```

### 3.1.3 查看当前所在的数据库

```sh
select database();
```

# 四、 k8s

## 4.1 

### 4.1.1 查看k8s底层的资源（包含在名称空间内的和不在名称空间内的）

```sh
kubectl api-resources
```

### 4.1.2 k8s中的镜像拉取策略

```sh
Always 总是拉取镜像
IfNotPresent 本地有则使用本地镜像,不拉取
Never 只使用本地镜像，从不拉取，即使本地没有
# 如果省略imagePullPolicy， 默认策略为always
```

### 4.1.3 k8s中查看某一个标签的资源

```sh
# 查看标签时canary-deloyv1的deploy
kubectl get deploy -l app=canary-deployv1
# 查看标签时canary-nginx的pod
kubectl get pod -l app=canary-nginx
```

### 4.1.4 k8s的证书存储路径

```sh
# 使用kubeadm安装的kubernetes集群的证书默认存储路径
/etc/kubernetes/pki/
```



# 其他

## nginx和lvs代理的区别

```sh
nginx代理服务器为隧道式代理
隧道式代理方式为：用户-->nginx代理服务器-->web服务器
                web服务器-->nginx代理服务器-->用户
此方式对nginx代理服务器性能要求较高，尤其在用户请求并发量高的时期

lvs代理服务器为DR式代理
lvs是专门做负载均衡的产品
DR式代理的方式为：用户-->lvs服务器-->web服务器
                web服务器-->用户
此方式可以使用在用户请求并非量高的生产环境中。
```

## 负载均衡的方式

```sh
ip_hash: 根据客户端的ip地址转发给同一台服务器
least_conn: 最少连接访问
url_hash: 根据用户访问的url定向转发请求
fair: 根据后端服务器响应时间转发请求
```

## centos7查看硬盘是SDD还是HDD

```sh
（1）lsblk -d -o name,rota
NAME ROTA
sda  0    # sda是固态硬盘(SDD)
# 因为SSD是非转动盘，如果返回结果为0说明是SSD硬盘，如果返回结果为1，说明是转动盘HDD类的硬盘
（2）cat /sys/block/sda/queue/rotational  
	  0 # 返回值为0 表明sda这块硬盘是固态硬盘(SSD)
（3）cat /proc/scsi/scsi
#我们可以看到硬盘的参数。这可以看到硬盘参数，然后搜索看看磁盘到底是什么就知道了。
```

## centos7和ubuntu更新为阿里云源的方法

```sh
############### centos7 ##############
## 备份系统自带yum源
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
## 下载阿里云yum源并配置为yum基础源
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
# 没有wget情况下可使用curl  查看源内容手动复制到基础源文件中
curl https://mirrors.aliyun.com/repo/Centos-7.repo

## 依据阿里云源更新软件包
yum -y update


#################### ubuntu22.04版本更新源为阿里云###################

在Ubuntu 22.04中使用国内源可以提高软件包下载和更新的速度。以下是如何设置国内源的步骤：
备份原有的sources.list文件：
sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup
编辑sources.list文件：
sudo nano /etc/apt/sources.list
替换文件内容为国内源。以阿里云源为例，你可以将文件内容替换为以下内容：
deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
 
deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse

保存并关闭文件。
更新软件源：
sudo apt update

升级所有安装的包：
sudo apt upgrade


################# 查询 LTS 版本： ########################## 

## 不按照lts版本会出现无法下载、无法解析域名等报错

root@user-virtual-machine:~# lsb_release  -a 
No LSB modules are available.
Distributor ID:    Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:    22.04
Codename:    jammy
root@user-virtual-machine:~# 
#####
Ubuntu 22.04代号为：jammy
Ubuntu 20.04代号为：focal
Ubuntu 19.04代号为：disco
Ubuntu 18.04代号为：bionic
Ubuntu 17.04代号为：zesty
Ubuntu 16.04代号为：xenial
```

## 配置bond的几种模式

```sh
bond4: 802.3ad
# 特点：创建一个聚合组，它们共享同样的速率和双工设定。根据802.3ad规范将多个slave工作在同一个激活的聚合体下
必要条件：
条件1：ethtool支持获取每个slave的速率和双工设定
条件2：switch(交换机)支持IEEE 802.3ad Dynamic link aggregation
条件3：大多数switch(交换机)需要经过特定配置才能支持802.3ad模式

bond6: balance-alb
# 该模式包含了balance­tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个slave的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。

# 系统中查看当前bond模式 ！！！
cat /proc/net/bonding/bond1
```

## 扩展系统分区

```sh
1、查看剩余空间（）
root@localhost:~# vgdisplay
  --- Volume group ---
  VG Name               ubuntu-vg
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               57.48 GiB
  PE Size               4.00 MiB
  Total PE              14715
  Alloc PE / Size       7357 / <28.74 GiB
  Free  PE / Size       7358 / 28.74 GiB   ### free表示剩余可用空间
  VG UUID               andaC5-NcQ6-tdpa-e4Bt-QzDC-Cs2H-BFmj4J

2、扩展逻辑卷
lvextend -L +1G /dev/**/** (此路径为fdisk -l 查看出来的系统所在路径)    /dev/sda3 （此路径为有空余空间分区的路径）
3、扩展文件系统
xfs_growfs /dev/rootvg/log   ### centos系统中使用命令
resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv   ###ubuntu系统中使用命令
```

## Ubuntu系统中给网卡子接口IP添加vlan标识

```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    mainif:
      match:
        macaddress: "de:ad:be:ef:ca:fe"
      set-name: mainif
      addresses: [ "10.3.0.5/23" ]
      nameservers:
        addresses: [ "8.8.8.8", "8.8.4.4" ]
        search: [ example.com ]
      routes:
        - to: default
          via: 10.3.0.1
  vlans:    # 添加vlan
    vlan15: # vlan名称
      id: 15   # 和交换机上的vlan id 一致
      link: ens33  # 网口名称
      addresses: [ "10.3.99.5/24" ]
    vlan10: # 第二个vlan
      id: 10 # 和交换机上的vlan id 一致
      link: extbond  # 网卡名称
      addresses: [ "10.3.98.5/24" ]
      nameservers:
        addresses: [ "127.0.0.1" ]
        search: [ domain1.example.com, domain2.example.com ]
```



## TIB换算为GB

```sh
fdisk 查看为3.49TiB
3.49TiB*1024 = 3573GiB
3573GiB * 1.074 = 3838GB
```

## bond状态一直是down

- 问题原因：做完bond6以后， 有一个网口是down的状态，排查后是因为 两个网口分别插了不同的交换机。
- 解决方法：
  - 将两个网口连接到同一个交换机
  - 先把bond删掉，把netplan的配置除管理网外都删掉，执行一下xtao-admin net up ,然后systemctl restart systemd-networkd

## 锁定软件包版本以防止其被自动更新

```
# 锁定软件包版本以防止其被自动更新
root@k8s-master:~# apt-mark hold kubelet kubeadm kubectl
```

## 监控具体是监控什么？

```sh
# 硬件监控
温度，硬件故障等
# 系统监控
cpu，内存，硬盘，网卡流量，TCP状态，进程数
# 应用监控
Nginx，Tomcat，PHP,MySQL，Redis等
# 安全监控
WAF，敏感文件监控
# API监控
可用性，接口请求，响应时间
# 业务监控
例如电商网站，每分钟产生多少订单、注册多少用户、多少活跃用户、推广活动效果
# 流量分许
根据流量获取用户相关信息，例如用户地理位置、某页面访问状况、页面停留时间等
```

